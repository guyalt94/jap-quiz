<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Japanese ROMAJI Quiz (200)</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111a33; --card2:#0f1730;
      --txt:#eaf0ff; --muted:#a9b7e6;
      --good:#2dd4bf; --bad:#fb7185; --warn:#fbbf24; --accent:#60a5fa;
      --shadow: 0 10px 35px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, rgba(96,165,250,.22), transparent 60%),
                  radial-gradient(900px 500px at 100% 40%, rgba(45,212,191,.16), transparent 55%),
                  var(--bg);
      color:var(--txt);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .wrap{width:min(920px, 100%);}
    .topbar{
      display:flex; gap:12px; align-items:stretch; flex-wrap:wrap;
      margin-bottom:12px;
    }
    .pill{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      padding:10px 12px;
      border-radius:999px;
      display:flex; gap:10px; align-items:center;
      box-shadow: 0 6px 20px rgba(0,0,0,.22);
    }
    .pill b{font-weight:700}
    .btn{
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.07);
      color:var(--txt);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      display:flex; align-items:center; gap:8px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .06s ease, background .2s ease;
    }
    .btn:active{transform: scale(.98)}
    .btn.primary{background:rgba(96,165,250,.18); border-color:rgba(96,165,250,.35)}
    .btn.good{background:rgba(45,212,191,.16); border-color:rgba(45,212,191,.35)}
    .btn.bad{background:rgba(251,113,133,.14); border-color:rgba(251,113,133,.35)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.10);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding:16px 16px 12px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      background: linear-gradient(180deg, rgba(17,26,51,.95), rgba(17,26,51,.65));
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .title{display:flex; flex-direction:column; gap:4px;}
    .title h1{margin:0; font-size:18px; letter-spacing:.2px}
    .title .sub{color:var(--muted); font-size:13px}
    .content{padding:16px;}
    .qbox{
      background: rgba(17,26,51,.55);
      border:1px solid rgba(255,255,255,.08);
      border-radius: 16px;
      padding:14px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
      margin-bottom:14px;
    }
    .word{
      font-size:34px;
      font-weight:800;
      letter-spacing:.4px;
      line-height:1.1;
      text-align:right;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
    .rightControls{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-start;
    }
    .answers{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
    }
    @media(min-width:680px){
      .answers{grid-template-columns: 1fr 1fr;}
      .word{font-size:40px}
    }
    .opt{
      background: rgba(15,23,48,.60);
      border:1px solid rgba(255,255,255,.10);
      border-radius: 16px;
      padding:14px 14px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      transition: transform .06s ease, border-color .15s ease, background .15s ease;
      min-height:56px;
    }
    .opt:active{transform:scale(.99)}
    .opt .label{font-size:16px; font-weight:650}
    .opt .tag{
      font-size:12px; color:rgba(255,255,255,.72);
      padding:4px 10px; border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      white-space:nowrap;
    }
    .opt.correct{border-color: rgba(45,212,191,.65); background: rgba(45,212,191,.10)}
    .opt.wrong{border-color: rgba(251,113,133,.65); background: rgba(251,113,133,.10)}
    .feedback{
      margin-top:12px;
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .feedback .msg{font-weight:650}
    .feedback.good{border-color: rgba(45,212,191,.45); background: rgba(45,212,191,.08)}
    .feedback.bad{border-color: rgba(251,113,133,.45); background: rgba(251,113,133,.08)}
    .mini{font-size:12px; color:var(--muted)}
    .footerRow{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:space-between;
      align-items:center;
    }
    .toggle{
      display:flex; gap:8px; align-items:center;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.10);
      padding:8px 10px;
      border-radius: 14px;
    }
    .toggle input{transform: scale(1.2)}
    .smallLink{
      color: var(--muted);
      text-decoration: underline;
      cursor:pointer;
    }
    .kbd{
      font-size:12px;
      color:rgba(255,255,255,.85);
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      border-radius: 10px;
      padding: 6px 10px;
    }
    .modalBackdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center; justify-content:center;
      padding:18px;
      z-index: 9999;
    }
    .modal{
      width:min(760px, 100%);
      background: rgba(17,26,51,.96);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHeader{
      padding:14px 16px;
      display:flex; justify-content:space-between; align-items:center;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .modalHeader b{font-size:15px}
    .modalBody{padding:14px 16px; color: var(--txt)}
    .modalBody p{margin:0 0 10px; color: var(--muted); line-height:1.55}
    .list{margin:0; padding-right:18px; color: var(--muted)}
    .list li{margin: 6px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="pill"><b>Japanese ROMAJI Quiz</b><span class="mini">200 ××™×œ×™× â€¢ ×ª×©×•×‘×•×ª ×‘×¢×‘×¨×™×ª</span></div>
      <div class="pill"><span>× ×›×•×Ÿ:</span> <b id="okCount">0</b> <span class="mini">|</span> <span>×œ× × ×›×•×Ÿ:</span> <b id="badCount">0</b></div>
      <div class="pill"><span>×¨×¦×£:</span> <b id="streak">0</b> <span class="mini">|</span> <span>×™×“×¢×ª×™:</span> <b id="knownCount">0</b></div>
      <button class="btn primary" id="speakBtn" title="×©××¢ ××ª ×”××™×œ×”">ğŸ”Š ×©××¢</button>
      <button class="btn good" id="knewBtn" title="×¡××Ÿ ×©×™×“×¢×ª×™ (×™×—×–×•×¨ ×¤×—×•×ª)">âœ… ×™×“×¢×ª×™</button>
      <button class="btn" id="skipBtn" title="×“×œ×’">â­ï¸ ×“×œ×’</button>
      <button class="btn" id="helpBtn" title="×¢×–×¨×”">â“</button>
      <button class="btn bad" id="resetBtn" title="××¤×¡ ×”×ª×§×“××•×ª">ğŸ—‘ï¸ ××™×¤×•×¡</button>
    </div>

    <div class="card">
      <div class="cardHeader">
        <div class="title">
          <h1 id="headline">××” ×”××©××¢×•×ª ×©×œ ×”××™×œ×”?</h1>
          <div class="sub" id="subline">×œ×—×¥ ×¢×œ ×ª×©×•×‘×”. ×× × ×›×•×Ÿ â€“ ×¢×•×‘×¨ ××•×˜×•××˜×™×ª. ×× ×œ× â€“ × ×©××¨ ×›×“×™ ×œ×œ××•×“.</div>
        </div>
        <div class="kbd" id="progress">×©××œ×” 1 / âˆ</div>
      </div>

      <div class="content">
        <div class="qbox">
          <div>
            <div class="word" id="word">...</div>
            <div class="hint" id="hint">×˜×™×¤: ×œ×—×¥ ×¢×œ ğŸ”Š ×œ×©××•×¢ (×™×¤× ×™×ª)</div>
          </div>
          <div class="rightControls">
            <div class="toggle">
              <input type="checkbox" id="autoSpeak" />
              <label for="autoSpeak">××•×“×™×• ××•×˜×•××˜×™</label>
            </div>
            <div class="toggle">
              <input type="checkbox" id="hardMode" />
              <label for="hardMode">××¦×‘ ×§×©×” (×¤×—×•×ª ×—×–×¨×•×ª)</label>
            </div>
          </div>
        </div>

        <div class="answers" id="answers"></div>

        <div class="feedback" id="feedback" style="display:none;">
          <div>
            <div class="msg" id="fbMsg">...</div>
            <div class="mini" id="fbMini">...</div>
          </div>
          <button class="btn" id="nextBtn">×”×‘×</button>
        </div>

        <div class="footerRow">
          <div class="mini">×©××™×¨×” ××•×˜×•××˜×™×ª ×‘××›×©×™×¨ (LocalStorage). ×× ××ª×” ×¤×•×ª×— ×œ×™× ×§ ×—×“×© â€“ ×–×” × ×©××¨.</div>
          <div class="smallLink" id="exportBtn">×™×™×¦×•×/×™×™×‘×•× ×”×ª×§×“××•×ª</div>
        </div>
      </div>
    </div>
  </div>

  <div class="modalBackdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modalHeader">
        <b id="modalTitle">×¢×–×¨×”</b>
        <button class="btn" id="closeModal">×¡×’×•×¨</button>
      </div>
      <div class="modalBody" id="modalBody"></div>
    </div>
  </div>

<script>
(() => {
  // 200 common words: romaji -> Hebrew meaning
  const WORDS = [
    ["hai","×›×Ÿ"],["iie","×œ×"],["arigatou","×ª×•×“×”"],["doumo","×ª×•×“×”/×”×™×™"],["sumimasen","×¡×œ×™×—×”/×ª×•×“×”"],["gomen","×¡×œ×™×—×”"],["onegai","×‘×‘×§×©×” (×‘×§×©×”)"],["kudasai","×‘×‘×§×©×” (×ª×Ÿ ×œ×™)"],
    ["ohayou","×‘×•×§×¨ ×˜×•×‘"],["konnichiwa","×©×œ×•×"],["konbanwa","×¢×¨×‘ ×˜×•×‘"],["oyasumi","×œ×™×œ×” ×˜×•×‘"],["ja ne","×™××œ×œ×” ×‘×™×™"],["mata ne","× ×ª×¨××”"],["sayounara","×©×œ×•×/×œ×”×ª×¨××•×ª"],["genki","××¨×’×™×© ×˜×•×‘/×× ×¨×’×˜×™"],
    ["watashi","×× ×™"],["boku","×× ×™ (×’×‘×¨×™)"],["anata","××ª×”/××ª"],["kare","×”×•×/×—×‘×¨"],["kanojo","×”×™×/×—×‘×¨×”"],["minna","×›×•×œ×"],["tomodachi","×—×‘×¨"],["hito","××“×"],
    ["namae","×©×"],["doko","××™×¤×”"],["itsu","××ª×™"],["nani","××”"],["dare","××™"],["naze","×œ××”"],["dou","××™×š"],["ikura","×›××” ×¢×•×œ×”"],
    ["kore","×–×” (×§×¨×•×‘ ××œ×™×™)"],["sore","×–×” (×§×¨×•×‘ ××œ×™×š)"],["are","×–×” (×©× ×¨×—×•×§)"],["koko","×¤×”"],["soko","×©× ×œ×™×“×š"],["asoko","×©× ×¨×—×•×§"],["kocchi","×›××Ÿ/×œ×›××Ÿ"],["socchi","×©×/×œ×©×"],
    ["ima","×¢×›×©×™×•"],["kyou","×”×™×•×"],["ashita","××—×¨"],["kinou","××ª××•×œ"],["mainichi","×›×œ ×™×•×"],["hayai","××”×™×¨/××•×§×“×"],["osoi","××™×˜×™/×××•×—×¨"],["sugu","××™×“"],
    ["yukkuri","×œ××˜"],["chotto","×§×¦×ª"],["takusan","×”×¨×‘×”"],["sukoshi","××¢×˜"],["zenzen","×‘×›×œ×œ ×œ×"],["mou","×›×‘×¨/×¢×•×“"],["mada","×¢×“×™×™×Ÿ"],["issho","×‘×™×—×“"],
    ["daijoubu","×‘×¡×“×¨/×”×›×œ ×˜×•×‘"],["ii","×˜×•×‘"],["warui","×¨×¢"],["omoshiroi","××¢× ×™×™×Ÿ/××¦×—×™×§"],["tsumaranai","××©×¢××"],["muzukashii","×§×©×”"],["kantan","×§×œ"],["taihen","×§×©×”/××ª×™×©"],
    ["ureshii","×©××—"],["kanashii","×¢×¦×•×‘"],["kowai","××¤×—×™×“"],["hazukashii","××‘×™×š"],["honto","×‘×××ª"],["uso","×©×§×¨"],["yabai","×‘×¢×™×™×ª×™/××˜×•×¨×£"],["sugoi","××“×”×™×"],
    ["taberu","×œ××›×•×œ"],["nomu","×œ×©×ª×•×ª"],["iku","×œ×œ×›×ª"],["kuru","×œ×‘×•×"],["kaeru","×œ×—×–×•×¨ ×”×‘×™×ª×”"],["miru","×œ×¨××•×ª"],["kiku","×œ×©××•×¢/×œ×©××•×œ"],["iu","×œ×”×’×™×“"],
    ["hanasu","×œ×“×‘×¨"],["yomu","×œ×§×¨×•×"],["kaku","×œ×›×ª×•×‘"],["kau","×œ×§× ×•×ª"],["harau","×œ×©×œ×"],["motsu","×œ×”×—×–×™×§"],["ageru","×œ×ª×ª"],["morau","×œ×§×‘×œ"],
    ["shiru","×œ×“×¢×ª"],["wakaru","×œ×”×‘×™×Ÿ"],["oboeru","×œ×–×›×•×¨"],["wasureru","×œ×©×›×•×—"],["tsukau","×œ×”×©×ª××©"],["tsukuru","×œ×‘× ×•×ª/×œ×”×›×™×Ÿ"],["benkyou","×œ×œ××•×“"],["hataraku","×œ×¢×‘×•×“"],
    ["yasumu","×œ× ×•×—"],["neru","×œ×™×©×•×Ÿ"],["okiru","×œ×§×•×"],["aruku","×œ×œ×›×ª ×‘×¨×’×œ"],["hashiru","×œ×¨×•×¥"],["suwaru","×œ×©×‘×ª"],["tatsu","×œ×¢××•×“"],["matsu","×œ×—×›×•×ª"],
    ["hajimeru","×œ×”×ª×—×™×œ"],["owaru","×œ×”×¡×ª×™×™×"],["akeru","×œ×¤×ª×•×—"],["shimeru","×œ×¡×’×•×¨"],["ireru","×œ×”×›× ×™×¡"],["dasu","×œ×”×•×¦×™×"],["toru","×œ×§×—×ª"],["suteru","×œ×–×¨×•×§"],
    ["denwa","×˜×œ×¤×•×Ÿ"],["keitai","× ×™×™×“"],["pasokon","××—×©×‘"],["kamera","××¦×œ××”"],["memo","×¤×ª×§"],["jikan","×–××Ÿ"],["toki","×¨×’×¢/×–××Ÿ"],["ima sugu","×¢×›×©×™×• ××™×“"],
    ["kane","×›×¡×£"],["okane","×›×¡×£ (×× ×•××¡)"],["saifu","××¨× ×§"],["kaado","×›×¨×˜×™×¡"],["shiharai","×ª×©×œ×•×"],["yasui","×–×•×œ"],["takai","×™×§×¨/×’×‘×•×”"],["nedan","××—×™×¨"],
    ["mise","×—× ×•×ª"],["resutoran","××¡×¢×“×”"],["kafe","×§×¤×”"],["pan","×œ×—×"],["gohan","××•×¨×–/××¨×•×—×”"],["mizu","××™×"],["ocha","×ª×” ×™×¨×•×§"],["biiru","×‘×™×¨×”"],
    ["wain","×™×™×Ÿ"],["osake","××œ×›×•×”×•×œ/×¡××§×”"],["nabe","×¡×™×¨/×ª×‘×©×™×œ"],["niku","×‘×©×¨"],["sakana","×“×’"],["yasai","×™×¨×§×•×ª"],["kudamono","×¤×™×¨×•×ª"],["tamago","×‘×™×¦×”"],
    ["shio","××œ×—"],["satou","×¡×•×›×¨"],["koohii","×§×¤×”"],["gyuunyuu","×—×œ×‘"],["chokoreeto","×©×•×§×•×œ×“"],["aisu","×’×œ×™×“×”"],["oishii","×˜×¢×™×"],["mazui","×œ× ×˜×¢×™×"],
    ["atatakai","×—××™×"],["tsumetai","×§×¨"],["atsui","×—×"],["samui","×§×¨ (××–×’ ××•×•×™×¨)"],["ame","×’×©×"],["yuki","×©×œ×’"],["kaze","×¨×•×—"],["tenki","××–×’ ××•×•×™×¨"],
    ["haru","××‘×™×‘"],["natsu","×§×™×¥"],["aki","×¡×ª×™×•"],["fuyu","×—×•×¨×£"],["asa","×‘×•×§×¨"],["hiru","×¦×”×¨×™×™×"],["yoru","×œ×™×œ×”"],["konshuu","×”×©×‘×•×¢"],
    ["raishuu","×©×‘×•×¢ ×”×‘×"],["senshuu","×©×‘×•×¢ ×©×¢×‘×¨"],["kotoshi","×”×©× ×”"],["rainen","×©× ×” ×”×‘××”"],["kyonen","×©× ×” ×©×¢×‘×¨×”"],["getsu","×—×•×“×©"],["shuu","×©×‘×•×¢"],["hi","×™×•×"],
    ["toshokan","×¡×¤×¨×™×™×”"],["gakkou","×‘×™×ª ×¡×¤×¨"],["daigaku","××•× ×™×‘×¨×¡×™×˜×”"],["kaisha","×—×‘×¨×”/×¢×‘×•×“×”"],["ie","×‘×™×ª"],["heya","×—×“×¨"],["toire","×©×™×¨×•×ª×™×"],["ofuro","×××‘×˜×™×”"],
    ["kagi","××¤×ª×—"],["kutsu","× ×¢×œ×™×™×"],["kaban","×ª×™×§"],["kasa","××˜×¨×™×™×”"],["doa","×“×œ×ª"],["mado","×—×œ×•×Ÿ"],["isu","×›×™×¡×"],["tsukue","×©×•×œ×—×Ÿ"],
    ["michi","×“×¨×š"],["eki","×ª×—× ×”"],["densha","×¨×›×‘×ª"],["basu","××•×˜×•×‘×•×¡"],["kuruma","×¨×›×‘"],["takushii","××•× ×™×ª"],["hikouki","××˜×•×¡"],["fune","×¡×¤×™× ×”"],
    ["chikatetsu","×¨×›×‘×ª ×ª×—×ª×™×ª"],["hoteru","××œ×•×Ÿ"],["yoyaku","×”×–×× ×”"],["passport","×“×¨×›×•×Ÿ"],["ryokou","×˜×™×•×œ"],["chizu","××¤×”"],["kippu","×›×¨×˜×™×¡ × ×¡×™×¢×”"],["iriguchi","×›× ×™×¡×”"],
    ["deguchi","×™×¦×™××”"],["hidari","×©×××œ"],["migi","×™××™×Ÿ"],["mae","×§×“×™××”/×œ×¤× ×™"],["ushiro","×××—×•×¨×”"],["ue","×œ××¢×œ×”"],["shita","×œ××˜×”"],["chikai","×§×¨×•×‘"],
    ["tooi","×¨×—×•×§"],["mou sukoshi","×¢×•×“ ×§×¦×ª"],["koko desu","×–×” ×¤×”"],["tasukete","×¢×–×¨×”!"],["abunai","××¡×•×›×Ÿ"],["daijina","×—×©×•×‘"],["hontou ni","×‘×××ª"],["yoku","×˜×•×‘/×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª"],
    ["sukina","××”×•×‘/××•×”×‘"],["kirai","×©×•× ×/×œ× ××•×”×‘"],["hoshii","×¨×•×¦×” (×—×¤×¥)"],["tabetai","×¨×•×¦×” ×œ××›×•×œ"],["nomitai","×¨×•×¦×” ×œ×©×ª×•×ª"],["ikitai","×¨×•×¦×” ×œ×œ×›×ª"],["mitai","×¨×•×¦×” ×œ×¨××•×ª"],["nemui","×¢×™×™×£/×™×©× ×•× ×™"],
    ["isogashii","×¢×¡×•×§"],["himana","×¤× ×•×™"],["tired","×¢×™×™×£"],["byouki","×—×•×œ×”"],["itai","×›×•××‘"],["kimochi","×”×¨×’×©×”"],["atama","×¨××©"],["te","×™×“"],
    ["ashi","×¨×’×œ"],["me","×¢×™×Ÿ"],["mimi","××•×–×Ÿ"],["hana","××£"],["kuchi","×¤×”"],["ha","×©×Ÿ"],["onaka","×‘×˜×Ÿ"],["se","×’×‘"],
    ["motto","×™×•×ª×¨"],["chigau","×©×•× ×”/×œ× ×–×”"],["atteiru","× ×›×•×Ÿ/××ª××™×"],["machigai","×˜×¢×•×ª"],["wakatta","×”×‘× ×ª×™"],["shiranai","×œ× ×™×•×“×¢"],["ii yo","×¡×‘×‘×”/×›×Ÿ"],["dame","××¡×•×¨/×œ× ×˜×•×‘"],
    ["kawaii","×—××•×“"],["kakkoii","××’× ×™×‘"],["kirei","×™×¤×”/× ×§×™"],["kitanai","××œ×•×›×œ×š"],["atarashii","×—×“×©"],["furui","×™×©×Ÿ"],["ookii","×’×“×•×œ"],["chiisai","×§×˜×Ÿ"],
    ["nagai","××¨×•×š"],["mijikai","×§×¦×¨"],["takusan","×”×¨×‘×”"],["sukunai","××¢×˜"],["akarui","×‘×”×™×¨"],["kurai","×—×©×•×š"],["omoi","×›×‘×“"],["karui","×§×œ (××©×§×œ)"],
    ["iro","×¦×‘×¢"],["shiroi","×œ×‘×Ÿ"],["kuroi","×©×—×•×¨"],["akai","××“×•×"],["aoi","×›×—×•×œ"],["kiiroi","×¦×”×•×‘"],["midori","×™×¨×•×§"],["pink","×•×¨×•×“"],
    ["ichi","××—×“"],["ni","×©×ª×™×™×"],["san","×©×œ×•×©"],["yon","××¨×‘×¢"],["go","×—××©"],["roku","×©×©"],["nana","×©×‘×¢"],["hachi","×©××•× ×”"],
    ["kyuu","×ª×©×¢"],["juu","×¢×©×¨"],["hyaku","×××”"],["sen","××œ×£"],["man","×¢×©×¨×ª ××œ×¤×™×"],["zero","××¤×¡"],["hanbun","×—×¦×™"],["zenbu","×”×›×œ"]
  ].slice(0,200);

  const LS_KEY = "jp_romaji_he_quiz_v1";
  const defaultState = {
    ok: 0, bad: 0, streak: 0,
    known: {},
    seen: {},
    hardMode: false,
    autoSpeak: false,
    lastWord: null,
    totalQuestions: 0
  };

  const $ = (id) => document.getElementById(id);

  let state = loadState();
  let current = null;
  let locked = false;

  function loadState(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return structuredClone(defaultState);
      const parsed = JSON.parse(raw);
      return {...structuredClone(defaultState), ...parsed};
    }catch{
      return structuredClone(defaultState);
    }
  }
  function saveState(){
    try{ localStorage.setItem(LS_KEY, JSON.stringify(state)); }catch{}
    renderStats();
  }

  function renderStats(){
    $("okCount").textContent = state.ok;
    $("badCount").textContent = state.bad;
    $("streak").textContent = state.streak;
    $("knownCount").textContent = Object.keys(state.known).length;
    $("hardMode").checked = !!state.hardMode;
    $("autoSpeak").checked = !!state.autoSpeak;
    $("progress").textContent = `×©××œ×” ${state.totalQuestions + 1} / âˆ`;
  }

  function pickNextWord(){
    const items = WORDS.map(([w,m]) => ({w, m}));
    const weights = items.map(it => {
      const seen = state.seen[it.w] || 0;
      const isKnown = !!state.known[it.w];
      const isLast = (it.w === state.lastWord);

      let weight = 1 / (1 + seen);
      if(isKnown) weight *= 0.18;
      if(isLast) weight *= 0.05;

      if(state.hardMode){
        weight *= 1 / (1 + seen*0.9);
        if(isKnown) weight *= 0.12;
      }
      return Math.max(weight, 0.0005);
    });

    const total = weights.reduce((a,b)=>a+b,0);
    let r = Math.random() * total;
    for(let i=0;i<items.length;i++){
      r -= weights[i];
      if(r <= 0) return items[i];
    }
    return items[items.length-1];
  }

  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]] = [arr[j],arr[i]];
    }
  }

  function buildQuestion(){
    const picked = pickNextWord();
    const correct = picked.m;

    const pool = WORDS.map(x => x[1]).filter(m => m !== correct);
    const opts = new Set([correct]);
    while(opts.size < 4){
      const m = pool[Math.floor(Math.random()*pool.length)];
      opts.add(m);
    }
    const options = Array.from(opts);
    shuffle(options);

    current = {
      word: picked.w,
      meaning: correct,
      options,
      correctIndex: options.indexOf(correct)
    };

    state.lastWord = picked.w;
    state.seen[picked.w] = (state.seen[picked.w] || 0) + 1;
    saveState();
  }

  function renderQuestion(){
    locked = false;
    $("word").textContent = current.word;
    $("feedback").style.display = "none";
    $("nextBtn").style.display = "none";
    $("answers").innerHTML = "";

    current.options.forEach((opt, idx) => {
      const div = document.createElement("div");
      div.className = "opt";
      div.setAttribute("role","button");
      div.tabIndex = 0;

      const label = document.createElement("div");
      label.className = "label";
      label.textContent = opt;

      const tag = document.createElement("div");
      tag.className = "tag";
      tag.textContent = `#${idx+1}`;

      div.appendChild(label);
      div.appendChild(tag);

      const handler = () => choose(idx, div);
      div.addEventListener("click", handler);
      div.addEventListener("keydown", (e) => {
        if(e.key === "Enter" || e.key === " ") handler();
      });

      $("answers").appendChild(div);
    });

    if(state.autoSpeak){
      speak(current.word);
    }
  }

  function showFeedback(kind, msg, mini){
    const fb = $("feedback");
    fb.className = "feedback " + kind;
    $("fbMsg").textContent = msg;
    $("fbMini").textContent = mini || "";
    fb.style.display = "flex";
  }

  function choose(idx, clickedEl){
    if(locked) return;
    locked = true;

    const optionsEls = Array.from(document.querySelectorAll(".opt"));
    const correctEl = optionsEls[current.correctIndex];

    const isCorrect = (idx === current.correctIndex);

    if(isCorrect){
      clickedEl.classList.add("correct");
      state.ok += 1;
      state.streak += 1;
      showFeedback("good", "× ×›×•×Ÿ! âœ…", `×”××©××¢×•×ª: ${current.meaning}`);
      saveState();
      setTimeout(() => nextQuestion(), 500);
    }else{
      clickedEl.classList.add("wrong");
      correctEl.classList.add("correct");
      state.bad += 1;
      state.streak = 0;
      showFeedback("bad", "×œ× × ×›×•×Ÿ âŒ", `×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${current.meaning}`);
      $("nextBtn").style.display = "inline-flex";
      saveState();
    }
  }

  function nextQuestion(){
    locked = false;
    state.totalQuestions += 1;
    saveState();
    buildQuestion();
    renderQuestion();
  }

  // Audio (SpeechSynthesis)
  let voices = [];
  function loadVoices(){
    voices = window.speechSynthesis ? window.speechSynthesis.getVoices() : [];
  }
  if(window.speechSynthesis){
    loadVoices();
    window.speechSynthesis.onvoiceschanged = loadVoices;
  }

  function pickJaVoice(){
    if(!voices || !voices.length) return null;
    const ja = voices.filter(v => (v.lang || "").toLowerCase().startsWith("ja"));
    return ja[0] || null;
  }

  function speak(text){
    if(!window.speechSynthesis){
      flashHint("××™×Ÿ ×ª××™×›×ª ××•×“×™×• ×‘×“×¤×“×¤×Ÿ ×”×–×” ğŸ˜•");
      return;
    }
    try{
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = "ja-JP";
      const v = pickJaVoice();
      if(v) u.voice = v;
      u.rate = 0.95;
      u.pitch = 1.0;
      window.speechSynthesis.speak(u);
    }catch{
      flashHint("×”××•×“×™×• × ×—×¡×. × ×¡×” ×œ×œ×—×•×¥ ×©×•×‘ ××—×¨×™ ×˜××¥×³.");
    }
  }

  function flashHint(msg){
    const old = $("hint").textContent;
    $("hint").textContent = msg;
    setTimeout(() => $("hint").textContent = old, 1800);
  }

  $("speakBtn").addEventListener("click", () => speak(current?.word || ""));
  $("skipBtn").addEventListener("click", () => nextQuestion());

  $("knewBtn").addEventListener("click", () => {
    if(!current) return;
    state.known[current.word] = true;
    saveState();
    showFeedback("good", "×¡×•××Ÿ ×›'×™×“×¢×ª×™' âœ…", "×”××™×œ×” ×ª×—×–×•×¨ ×‘×ª×“×™×¨×•×ª × ××•×›×” ×‘×”×¨×‘×”.");
    $("nextBtn").style.display = "inline-flex";
  });

  $("nextBtn").addEventListener("click", () => nextQuestion());

  $("hardMode").addEventListener("change", (e) => {
    state.hardMode = e.target.checked;
    saveState();
    flashHint(state.hardMode ? "××¦×‘ ×§×©×”: ×¤×—×•×ª ×—×–×¨×•×ª âœ…" : "××¦×‘ ×§×©×” ×›×‘×•×™");
  });

  $("autoSpeak").addEventListener("change", (e) => {
    state.autoSpeak = e.target.checked;
    saveState();
    flashHint(state.autoSpeak ? "××•×“×™×• ××•×˜×•××˜×™: ××•×¤×¢×œ âœ…" : "××•×“×™×• ××•×˜×•××˜×™: ×›×‘×•×™");
  });

  $("resetBtn").addEventListener("click", () => {
    if(!confirm("×œ××¤×¡ ×”×›×œ? (× ×›×•×Ÿ/×œ× × ×›×•×Ÿ/×™×“×¢×ª×™)")) return;
    state = structuredClone(defaultState);
    saveState();
    buildQuestion();
    renderQuestion();
    flashHint("××•×¤×¡â€¦ ×”×›×œ ××•×¤×¡.");
  });

  function openModal(title, html){
    $("modalTitle").textContent = title;
    $("modalBody").innerHTML = html;
    $("modalBackdrop").style.display = "flex";
  }
  function closeModal(){
    $("modalBackdrop").style.display = "none";
  }
  $("helpBtn").addEventListener("click", () => {
    openModal("×¢×–×¨×” (×‘××™×™×¤×•×Ÿ)", `
      <p>×× ××ª×” ×¤×•×ª×— ××ª ×”×§×•×‘×¥ ×›×´×§×•×‘×¥×´ ×‘×¡×¤××¨×™ â€“ ×¡×¤××¨×™ ×—×•×¡× JS/××•×“×™×•. ×œ×›×Ÿ ×—×™×™×‘×™× ×œ×¤×ª×•×— ×“×¨×š <b>×œ×™× ×§</b> (GitHub Pages / Netlify ×•×›×•×³).</p>
      <ul class="list">
        <li><b>ğŸ”Š ×©××¢</b> â€“ ××©××™×¢ ××ª ×”××™×œ×” (romaji) ×‘×§×•×œ ×™×¤× ×™.</li>
        <li><b>âœ… ×™×“×¢×ª×™</b> â€“ ××¡××Ÿ ×›××™×œ×” ××•×›×¨×ª, ×•×”×™× ×ª×—×–×•×¨ ×”×¨×‘×” ×¤×—×•×ª.</li>
        <li><b>××¢×‘×¨ ××•×˜×•××˜×™</b> â€“ ×× ×¦×“×§×ª, ×–×” ×¢×•×‘×¨ ×œ×‘×“ ×œ×©××œ×” ×”×‘××”.</li>
        <li><b>×× ×˜×¢×™×ª</b> â€“ ×”×•× × ×©××¨ ×›×“×™ ×©×ª×¨××” ××ª ×”×ª×©×•×‘×” ×”× ×›×•× ×”.</li>
      </ul>
      <p class="mini">×˜×™×¤: iOS ×œ×¤×¢××™× ×œ× × ×•×ª×Ÿ ××•×“×™×• ××•×˜×•××˜×™ ×¢×“ ×©×¢×•×©×™× ×¤×¢× ××—×ª ×˜××¥×³ ×¢×œ ×›×¤×ª×•×¨ ğŸ”Š.</p>
    `);
  });

  $("exportBtn").addEventListener("click", () => {
    const data = btoa(unescape(encodeURIComponent(JSON.stringify(state))));
    openModal("×™×™×¦×•× / ×™×™×‘×•×", `
      <p>×¨×•×¦×” ×œ×”×¢×‘×™×¨ ×”×ª×§×“××•×ª ×‘×™×Ÿ ××›×©×™×¨×™×? ×”×¢×ª×§/×”×“×‘×§ ××ª ×”×˜×§×¡×˜.</p>
      <p class="mini">×™×™×¦×•× (copy):</p>
      <textarea id="ex" style="width:100%;height:110px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.25);color:var(--txt);padding:10px;direction:ltr" readonly>${data}</textarea>
      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
        <button class="btn primary" id="copyEx">×”×¢×ª×§</button>
        <button class="btn" id="importBtn">×™×™×‘×•×</button>
      </div>
      <p class="mini" style="margin-top:10px;">×™×™×‘×•×: ×”×“×‘×§ ×›××Ÿ ×•××– ×œ×—×¥ ×´×™×™×‘×•××´</p>
      <textarea id="im" style="width:100%;height:110px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.25);color:var(--txt);padding:10px;direction:ltr"></textarea>
    `);

    setTimeout(() => {
      const copyBtn = document.getElementById("copyEx");
      const importBtn = document.getElementById("importBtn");
      const ex = document.getElementById("ex");
      const im = document.getElementById("im");

      copyBtn?.addEventListener("click", async () => {
        try{
          await navigator.clipboard.writeText(ex.value);
          flashHint("×”×•×¢×ª×§ âœ…");
        }catch{
          ex.select(); document.execCommand("copy");
          flashHint("×”×•×¢×ª×§ âœ…");
        }
      });

      importBtn?.addEventListener("click", () => {
        try{
          const raw = im.value.trim();
          if(!raw) return;
          const decoded = decodeURIComponent(escape(atob(raw)));
          const parsed = JSON.parse(decoded);
          state = {...structuredClone(defaultState), ...parsed};
          saveState();
          buildQuestion();
          renderQuestion();
          closeModal();
          flashHint("×™×•×‘× âœ…");
        }catch{
          alert("×œ× ×”×¦×œ×—×ª×™ ×œ×™×™×‘×. ×‘×“×•×§ ×©×”×˜×§×¡×˜ ××œ× ×•× ×›×•×Ÿ.");
        }
      });
    }, 50);
  });

  $("closeModal").addEventListener("click", closeModal);
  $("modalBackdrop").addEventListener("click", (e) => {
    if(e.target === $("modalBackdrop")) closeModal();
  });

  renderStats();
  buildQuestion();
  renderQuestion();
})();
</script>
</body>
</html>
